project(pyArborX LANGUAGES CXX)

add_subdirectory(/pybind11 /root/lib/pybind11)
find_package(ArborX REQUIRED)

# set the template options in config.hpp to the desired configuration
include_directories(".")

# definition of submodules included in build
set(PY_MODULES Point Box Experimental BVH Views ExecutionSpace Util)
# set(PY_MODULES Point Box Experimental BVH Util)

# define type of views to be autogenerated TODO: transfer this form preproc to cmake
set(PY_VIEWS PointView IntersectView intView1D)

#generator for top level module file to be loaded in python
foreach(PY_MODULE IN LISTS PY_MODULES)
  add_subdirectory(./${PY_MODULE})
  list(APPEND PY_IMPORT "from .${PY_MODULE} import * \n")
endforeach()

#generator for views module file to be loaded in python
foreach(PY_VIEW IN LISTS PY_VIEWS)
  list(APPEND PY_VIEW_IMPORT "from .${PY_VIEW} import * \n")
endforeach()
         
file(MAKE_DIRECTORY ${PROJECT_BINARY_DIR}/pyArborX)
file(MAKE_DIRECTORY ${PROJECT_BINARY_DIR}/pyArborX/Views)
file(WRITE ${PROJECT_BINARY_DIR}/pyArborX/__init__.py ${PY_IMPORT})
file(WRITE ${PROJECT_BINARY_DIR}/pyArborX/Views/__init__.py ${PY_VIEW_IMPORT})
